<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social App</title>
    <link rel="stylesheet" href="style.css">
    <!-- Using Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Auth Section -->
        <div id="auth-container" class="glass">
            <h2>Welcome Back</h2>
            <div class="tabs">
                <button id="tab-login" class="active">Login</button>
                <button id="tab-register">Register</button>
            </div>
            
            <form id="login-form">
                <input type="text" id="login-username" placeholder="Username" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <input type="text" id="login-mfa" placeholder="MFA Code (if enabled)" style="display:none;">
                <button type="submit">Sign In</button>
            </form>

            <form id="register-form" style="display:none;">
                <input type="text" id="reg-username" placeholder="Username" required>
                <input type="password" id="reg-password" placeholder="Password" required>
                <button type="submit">Create Account</button>
            </form>
            <p id="auth-message" style="margin-top: 1rem; color: var(--danger); text-align: center;"></p>
        </div>

        <!-- MFA Setup Section -->
        <div id="mfa-setup-container" style="display:none;">
            <h2>Secure Your Account</h2>
            <p style="text-align: center; margin-bottom: 2rem; color: var(--text-muted);">Scan this QR Code with Google Authenticator</p>
            <div id="qrcode-container" style="display: flex; justify-content: center; margin-bottom: 2rem;"></div>
            <form id="mfa-verify-form">
                <input type="text" id="verify-token" placeholder="Enter 6-digit Code" required>
                <button type="submit">Verify & Enable</button>
            </form>
            <button id="skip-mfa" style="background: transparent; color: var(--text-muted); margin-top: 1rem; width: 100%;">Skip for now</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-container" style="display:none;">
            <div class="sidebar">
                <div class="user-profile">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="avatar" id="my-avatar">U</div>
                        <h3 id="current-username">User</h3>
                    </div>
                    <div>
                        <button id="admin-btn" style="display:none; color: var(--primary);">Admin</button>
                        <button id="logout-btn">Logout</button>
                    </div>
                </div>
                
                <div class="search-box" style="position: relative;">
                    <input type="text" id="user-search" placeholder="Search users...">
                    <button id="search-btn" style="padding: 0.5rem 1rem;">üîç</button>
                    <div id="search-results" style="display: none;"></div>
                </div>

                <div class="nav-section">
                    <h4>Chats</h4>
                    <ul id="chat-list">
                        <!-- Dynamic Chat List with Previews -->
                    </ul>
                    
                    <h4>Friends</h4>
                    <ul id="friend-list"></ul>

                    <h4>Groups</h4>
                    <ul id="group-list"></ul>
                    <div style="padding: 1rem;">
                        <button id="create-group-btn" style="width: 100%; background: #f1f5f9; color: var(--text-main);">+ New Group</button>
                    </div>
                </div>
            </div>

            <div class="main-chat" id="main-chat-area">
                <div id="chat-header" style="display:none;">
                    <div id="back-btn" style="display:none; font-size: 1.5rem;">‚Üê</div>
                    <div class="avatar" id="chat-avatar"></div>
                    <div id="chat-title" style="flex: 1;">Select a chat</div>
                    <button id="group-info-btn" style="display:none; background: transparent; font-size: 1.2rem; cursor: pointer;">‚ÑπÔ∏è</button>
                </div>

                <div id="chat-messages">
                    <div class="placeholder">
                        <div style="text-align: center;">
                            <h2 style="color: var(--text-muted);">Select a conversation</h2>
                            <p style="color: var(--text-muted); opacity: 0.7;">Choose a friend or group from the sidebar to start chatting.</p>
                        </div>
                    </div>
                </div>

                <form id="chat-input-form" style="display:none;">
                    <input type="text" id="message-input" placeholder="Type a message..." required autocomplete="off">
                    <button type="submit">‚û§</button>
                </form>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; height: 80%; background: white; z-index: 200; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); padding: 2rem; overflow: auto;">
            <div class="panel-header" style="margin-bottom: 2rem; display: flex; justify-content: space-between;">
                <h2>Admin Dashboard</h2>
                <button id="close-admin" style="background: transparent; color: var(--text-muted);">‚úï</button>
            </div>
            <div id="admin-stats" class="stats-grid"></div>
            <div class="user-management">
                <h3>All Users</h3>
                <table id="users-table">
                    <thead>
                        <tr><th>ID</th><th>Username</th><th>Role</th><th>MFA</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
        <!-- Modal for Group Creation -->
        <div id="modal-overlay" style="display:none;">
            <div class="modalBox" style="background: white; padding: 2rem; border-radius: 12px; width: 320px;">
                <h3>Create New Group</h3>
                <input type="text" id="new-group-name" placeholder="Group Name" style="margin: 1rem 0;">
                <div style="display: flex; gap: 10px;">
                    <button id="confirm-create-group" style="flex: 1;">Create</button>
                    <button id="cancel-modal" style="flex: 1; background: #f1f5f9; color: var(--text-main);">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Modal for Group Info -->
        <div id="group-info-modal-overlay" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 300;">
            <div class="modalBox" style="background: white; padding: 2rem; border-radius: 12px; width: 400px; max-height: 80vh; display: flex; flex-direction: column;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 id="modal-group-name">Group Info</h3>
                    <button id="close-group-info" style="background: transparent; color: #999;">‚úï</button>
                </div>
                
                <div id="group-actions" style="margin-bottom: 1rem; display: none;">
                    <h4>Add Member</h4>
                    <div style="display: flex; gap: 0.5rem;">
                         <select id="friend-select-dropdown" style="padding: 0.5rem; border-radius: 6px; border: 1px solid #ddd; flex: 1;">
                             <option value="">Select a friend...</option>
                         </select>
                         <button id="add-member-btn" class="btn-small">Add</button>
                    </div>
                </div>

                <h4>Members (<span id="member-count">0</span>)</h4>
                <ul id="group-member-list" style="overflow-y: auto; flex: 1; border: 1px solid #eee; border-radius: 8px; margin-top: 0.5rem;">
                    <!-- Members go here -->
                </ul>
                
                <button id="leave-group-btn" style="background: var(--danger); color: white; margin-top: 1rem;">Leave Group</button>
            </div>
        </div>

    </div>
    <script src="app.js"></script>
</body>
</html>
