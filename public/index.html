<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatVerse ‚Äî Modern Messaging</title>
    <meta name="description" content="ChatVerse - A premium social messaging app with groups, friends, and real-time communication.">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Auth Section -->
        <div id="auth-container">
            <div class="auth-card glass">
                <div class="auth-logo">
                    <div class="logo-icon">üí¨</div>
                    <h1>ChatVerse</h1>
                    <p class="auth-subtitle">Connect. Chat. Collaborate.</p>
                </div>
                <div class="tabs">
                    <button id="tab-login" class="active">Sign In</button>
                    <button id="tab-register">Sign Up</button>
                </div>
                
                <form id="login-form">
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">person</span>
                        <input type="text" id="login-username" placeholder="Username" required>
                    </div>
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">lock</span>
                        <input type="password" id="login-password" placeholder="Password" required>
                    </div>
                    <div class="input-group" id="mfa-input-group" style="display:none;">
                        <span class="input-icon material-symbols-rounded">security</span>
                        <input type="text" id="login-mfa" placeholder="MFA Code">
                    </div>
                    <button type="submit" class="btn-primary">
                        <span>Sign In</span>
                        <span class="material-symbols-rounded">arrow_forward</span>
                    </button>
                </form>

                <form id="register-form" style="display:none;">
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">person_add</span>
                        <input type="text" id="reg-username" placeholder="Choose a username" required>
                    </div>
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">lock</span>
                        <input type="password" id="reg-password" placeholder="Create a password" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <span>Create Account</span>
                        <span class="material-symbols-rounded">arrow_forward</span>
                    </button>
                </form>
                <p id="auth-message"></p>
            </div>
        </div>

        <!-- MFA Setup Section -->
        <div id="mfa-setup-container" style="display:none;">
            <div class="auth-card glass">
                <div class="auth-logo">
                    <div class="logo-icon">üîê</div>
                    <h2>Secure Your Account</h2>
                    <p class="auth-subtitle">Scan this QR Code with Google Authenticator</p>
                </div>
                <div id="qrcode-container" style="display: flex; justify-content: center; margin-bottom: 1.5rem;"></div>
                <form id="mfa-verify-form">
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">pin</span>
                        <input type="text" id="verify-token" placeholder="Enter 6-digit Code" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <span>Verify & Enable</span>
                    </button>
                </form>
                <button id="skip-mfa" class="btn-ghost">Skip for now</button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-container" style="display:none;">
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="user-profile">
                        <div class="avatar" id="my-avatar">U</div>
                        <div class="user-info">
                            <h3 id="current-username">User</h3>
                            <span class="status-dot online"></span>
                            <span class="status-text">Online</span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button onclick="toggleTheme()" class="icon-btn" title="Toggle Theme">
                            <span class="material-symbols-rounded">contrast</span>
                        </button>
                        <button id="games-hub-btn" class="icon-btn" title="Gaming Hub" onclick="openGameHub()">
                            <span class="material-symbols-rounded">sports_esports</span>
                        </button>
                        <button id="admin-btn" class="icon-btn" style="display:none;" title="Admin Panel">
                            <span class="material-symbols-rounded">admin_panel_settings</span>
                        </button>
                        <button id="logout-btn" class="icon-btn" title="Logout">
                            <span class="material-symbols-rounded">logout</span>
                        </button>
                    </div>
                </div>
                
                <div class="search-box">
                    <span class="material-symbols-rounded search-icon">search</span>
                    <input type="text" id="user-search" placeholder="Search usernames...">
                    <button id="search-filter-btn" class="icon-btn-sm" title="Search Filters">
                        <span class="material-symbols-rounded">filter_list</span>
                    </button>
                    <div id="search-results" class="search-results-overlay glass" style="display: none;"></div>
                </div>

                <!-- Search Filters Panel -->
                <div id="search-filters-panel" class="glass" style="display:none; margin: 0 1rem 10px 1rem; padding: 10px; border-radius:12px; border:1px solid var(--border); animation: slideDown 0.2s;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                        <span style="font-size:0.7rem; font-weight:bold; color:var(--text-secondary);">SEARCH FILTERS</span>
                        <button onclick="clearSearchFilters()" style="background:none; border:none; color:var(--accent); font-size:0.65rem; cursor:pointer; font-weight:600;">Clear</button>
                    </div>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <div class="filter-group">
                            <label style="font-size:0.65rem; color:var(--text-muted); display:block; margin-bottom:2px;">Status</label>
                            <select id="filter-online" onchange="performSearch()" style="background:var(--bg-secondary); color:var(--text-primary); border:1px solid var(--border); border-radius:4px; font-size:0.75rem; padding:2px 4px; outline:none; width: 100px;">
                                <option value="any">Any Status</option>
                                <option value="true">Online</option>
                                <option value="false">Offline</option>
                            </select>
                        </div>
                        <div class="filter-group" id="admin-role-filter" style="display:none;">
                            <label style="font-size:0.65rem; color:var(--text-muted); display:block; margin-bottom:2px;">Role</label>
                            <select id="filter-role" onchange="performSearch()" style="background:var(--bg-secondary); color:var(--text-primary); border:1px solid var(--border); border-radius:4px; font-size:0.75rem; padding:2px 4px; outline:none; width: 80px;">
                                <option value="">Any Role</option>
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="section-header">
                        <h4><span class="material-symbols-rounded">chat</span> Chats</h4>
                    </div>
                    <ul id="chat-list"></ul>
                    
                    <div class="section-header">
                        <h4><span class="material-symbols-rounded">group</span> Friends</h4>
                    </div>
                    <ul id="friend-list"></ul>

                    <div class="section-header">
                        <h4><span class="material-symbols-rounded">groups</span> Groups</h4>
                    </div>
                    <ul id="group-list"></ul>
                    
                    <div id="sidebar-game-invites" style="display:none; margin: 10px 0;">
                        <div class="section-header">
                            <h4 style="color:var(--accent)"><span class="material-symbols-rounded" style="animation: pulse 1s infinite;">notifications</span> Incoming Invites</h4>
                        </div>
                        <ul id="game-invite-list" style="list-style:none; padding:0; margin:0;"></ul>
                    </div>

                    <div class="sidebar-action">
                        <button id="create-group-btn">
                            <span class="material-symbols-rounded">add</span>
                            <span>New Group</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="main-chat" id="main-chat-area">
                <div id="chat-header" style="display:none;">
                    <div id="back-btn" style="display:none;">
                        <span class="material-symbols-rounded">arrow_back</span>
                    </div>
                    <div class="avatar" id="chat-avatar"></div>
                    <div class="chat-header-info">
                        <div id="chat-title">Select a chat</div>
                        <div id="chat-subtitle" class="chat-subtitle">tap for info</div>
                    </div>
                    <button id="group-info-btn" class="icon-btn" style="display:none;">
                        <span class="material-symbols-rounded">info</span>
                    </button>
                </div>

                <div id="chat-messages">
                    <div class="placeholder">
                        <div class="placeholder-content">
                            <div class="placeholder-icon">üí¨</div>
                            <h2>ChatVerse</h2>
                            <p>Select a conversation to start messaging</p>
                        </div>
                    </div>
                </div>

                <form id="chat-input-form" style="display:none;">
                    <input type="file" id="attachment-input" style="display:none;" accept="image/*,.pdf">
                    <button type="button" id="attach-btn" class="icon-btn-sm" title="Attach Image or PDF">
                        <span class="material-symbols-rounded">attach_file</span>
                    </button>
                    <button type="button" class="icon-btn-sm emoji-btn">
                        <span class="material-symbols-rounded">mood</span>
                    </button>
                    <input type="text" id="message-input" placeholder="Type a message..." required autocomplete="off">
                    <button type="submit" class="send-btn">
                        <span class="material-symbols-rounded">send</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" style="display:none;">
            <div class="admin-container glass">
                <div class="admin-header">
                    <h2><span class="material-symbols-rounded">admin_panel_settings</span> Admin Dashboard</h2>
                    <button id="close-admin" class="icon-btn">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                <div id="admin-stats" class="stats-grid"></div>
                <div class="tabs" style="margin-bottom: 1.5rem;">
                    <button id="admin-tab-users" class="active" onclick="switchAdminTab('users')">Users</button>
                    <button id="admin-tab-groups" onclick="switchAdminTab('groups')">Groups</button>
                    <button id="admin-tab-monitor" onclick="switchAdminTab('monitor')">Monitor</button>
                </div>

                <div id="admin-content-users" class="admin-tab-content">
                    <div class="user-management">
                        <h3>User Management</h3>
                        <table id="users-table">
                            <thead>
                                <tr><th>ID</th><th>Username</th><th>Role</th><th>MFA</th><th>Status</th><th>Actions</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="admin-content-groups" class="admin-tab-content" style="display:none;">
                    <div class="group-management">
                        <h3>Group Management</h3>
                        <table id="admin-groups-table">
                            <thead>
                                <tr><th>ID</th><th>Group Name</th><th>Creator</th><th>Members</th><th>Actions</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="admin-content-monitor" class="admin-tab-content" style="display:none;">
                    <div class="monitor-management" style="display: grid; grid-template-columns: 240px 1fr; gap: 20px;">
                        <div class="conversation-list-admin glass" style="height: 400px; overflow-y: auto; padding: 10px; border-radius: 12px;">
                            <h4 style="margin-bottom: 10px; font-size: 0.9rem;">Active Conversations</h4>
                            <div id="admin-conv-list" style="display: flex; flex-direction: column; gap: 5px;">
                                <p style="font-size: 0.8rem; color: var(--text-muted); text-align: center;">Loading...</p>
                            </div>
                        </div>
                        <div class="monitor-chat-view">
                            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom:1rem;">
                                <h3>Conversation Monitor</h3>
                                <div style="display:flex; gap:10px;">
                                    <input type="number" id="monitor-user-1" placeholder="UID1" style="width:70px; font-size: 0.8rem;">
                                    <input type="number" id="monitor-user-2" placeholder="UID2" style="width:70px; font-size: 0.8rem;">
                                    <button class="btn-primary btn-xs" onclick="startMonitoring()">Monitor</button>
                                </div>
                            </div>
                            <div id="monitor-messages" class="chat-messages glass" style="height:340px; overflow-y:auto; border-radius:12px; padding:1rem;">
                                <p style="text-align:center; color:var(--text-muted);">Select a conversation or enter IDs</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal for Group Creation -->
        <div id="modal-overlay" style="display:none;">
            <div class="modal-card glass">
                <h3><span class="material-symbols-rounded">group_add</span> Create New Group</h3>
                <div class="input-group">
                    <span class="input-icon material-symbols-rounded">label</span>
                    <input type="text" id="new-group-name" placeholder="Group Name">
                </div>
                <div class="modal-actions">
                    <button id="confirm-create-group" class="btn-primary">Create</button>
                    <button id="cancel-modal" class="btn-ghost">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Modal for Group Info -->
        <div id="group-info-modal-overlay" style="display:none;">
            <div class="modal-card glass" style="width: 420px; max-height: 80vh; display: flex; flex-direction: column;">
                <div class="modal-header">
                    <h3 id="modal-group-name">Group Info</h3>
                    <button id="close-group-info" class="icon-btn">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                
                <div id="group-actions" style="margin-bottom: 1rem; display: none;">
                    <h4>Add Member</h4>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                         <select id="friend-select-dropdown">
                             <option value="">Select a friend...</option>
                         </select>
                         <button id="add-member-btn" class="btn-primary btn-sm">Add</button>
                    </div>
                </div>

                <h4>Members (<span id="member-count">0</span>)</h4>
                <ul id="group-member-list" class="member-list"></ul>
                
                <button id="leave-group-btn" class="btn-danger">
                    <span class="material-symbols-rounded">logout</span>
                    Leave Group
                </button>
            </div>
        </div>

        <!-- Profile Settings Modal -->
        <div id="profile-modal-overlay" style="display:none;">
            <div class="modal-card glass" style="width: 480px; max-height: 85vh; display: flex; flex-direction: column;">
                <div class="modal-header">
                    <h3><span class="material-symbols-rounded">person</span> Profile Settings</h3>
                    <button id="close-profile-modal" class="icon-btn">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                
                <div class="tabs" style="margin-bottom: 1rem;">
                    <button id="tab-general" class="active" onclick="switchProfileTab('general')">General</button>
                    <button id="tab-security" onclick="switchProfileTab('security')">Security</button>
                    <button id="tab-app" onclick="switchProfileTab('app')">App</button>
                </div>

                <div id="profile-content-general" class="profile-tab-content">
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <div class="avatar" id="profile-avatar-preview" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto; transition: background 0.3s;"></div>
                        <h3 id="profile-username" style="margin-top: 0.5rem;">User</h3>
                    </div>

                    <div class="input-group">
                        <label style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem; display: block;">Bio / Status</label>
                        <input type="text" id="profile-bio" placeholder="What's on your mind?">
                    </div>

                    <div class="input-group">
                        <label style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem; display: block;">Avatar Color</label>
                        <div class="color-picker">
                            <button class="color-dot" style="background:#ef4444" onclick="selectAvatarColor('#ef4444')"></button>
                            <button class="color-dot" style="background:#f97316" onclick="selectAvatarColor('#f97316')"></button>
                            <button class="color-dot" style="background:#f59e0b" onclick="selectAvatarColor('#f59e0b')"></button>
                            <button class="color-dot" style="background:#10b981" onclick="selectAvatarColor('#10b981')"></button>
                            <button class="color-dot" style="background:#06b6d4" onclick="selectAvatarColor('#06b6d4')"></button>
                            <button class="color-dot" style="background:#3b82f6" onclick="selectAvatarColor('#3b82f6')"></button>
                            <button class="color-dot" style="background:#8b5cf6" onclick="selectAvatarColor('#8b5cf6')"></button>
                            <button class="color-dot" style="background:#ec4899" onclick="selectAvatarColor('#ec4899')"></button>
                        </div>
                        <input type="hidden" id="profile-avatar-color">
                    </div>

                    <button class="btn-primary" onclick="saveProfileGeneral()">Save Changes</button>
                </div>

                <div id="profile-content-security" class="profile-tab-content" style="display:none;">
                    <h4>Change Password</h4>
                    <form id="change-password-form" onsubmit="changePassword(event)">
                        <input type="password" id="old-password" placeholder="Current Password" required style="margin-bottom: 0.5rem;">
                        <input type="password" id="new-password" placeholder="New Password" required style="margin-bottom: 0.5rem;">
                        <button type="submit" class="btn-small">Update Password</button>
                    </form>
                    
                    <hr style="border: 0; border-top: 1px solid var(--border); margin: 1.5rem 0;">

                    <h4>Two-Factor Authentication</h4>
                    <div id="mfa-status-section">
                        <p id="mfa-status-text" style="margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-muted);">Status: <span id="mfa-status-badge" class="role-badge">Checking...</span></p>
                        <button id="btn-enable-mfa" class="btn-small" onclick="enableMFA()" style="display:none;">Enable MFA (Setup)</button>
                        <button id="btn-disable-mfa" class="btn-small btn-danger" onclick="promptDisableMFA()" style="display:none;">Disable MFA</button>
                    </div>
                </div>

                <div id="profile-content-app" class="profile-tab-content" style="display:none;">
                    <h4>Notifications</h4>
                    <div class="setting-row">
                        <span>Message Sounds</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-sound" checked onchange="toggleSetting('sound')">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <span>Browser Notifications</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-browser-notif" onchange="toggleSetting('browserNotif')">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <hr style="border: 0; border-top: 1px solid var(--border); margin: 1.5rem 0;">

                    <h4>Theme</h4>
                    <div class="setting-row">
                        <span>Dark Mode</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-dark-mode" checked onchange="toggleTheme()">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

            </div>
        </div>

        <!-- Gaming Center Modal -->
        <div id="game-modal-overlay" style="display:none;">
            <div class="modal-card glass" style="width: 500px; max-height: 85vh;">
                <div class="modal-header">
                    <h3><span class="material-symbols-rounded">sports_esports</span> Gaming Hub</h3>
                    <button id="close-game-modal" class="icon-btn">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>

                <div id="game-selection-view">
                    <p style="color:var(--text-secondary); margin-bottom: 1.5rem;">Choose a game to play with friends!</p>
                    <div class="game-grid">
                        <div class="game-tile glass" onclick="selectGame('tic-tac-toe')">
                            <div class="game-icon">‚ùå‚≠ï</div>
                            <h4>Tic-Tac-Toe</h4>
                            <p>Classic 3x3 battle</p>
                        </div>
                        <div class="game-tile glass disabled">
                            <div class="game-icon">‚ôüÔ∏è</div>
                            <h4>Chess</h4>
                            <p>Coming Soon</p>
                        </div>
                    </div>
                </div>

                <div id="game-invite-view" style="display:none;">
                    <button class="btn-ghost" onclick="backToGameSelection()" style="margin-bottom: 1rem; padding: 0;">
                        <span class="material-symbols-rounded">arrow_back</span> Back
                    </button>
                    <h3>Invite Opponent</h3>
                    
                    <div class="search-box" style="margin: 1rem 0;">
                        <span class="material-symbols-rounded">search</span>
                        <input type="text" id="game-user-search" placeholder="Type username..." oninput="searchGameUsers()">
                    </div>
                    <div id="game-search-results" style="max-height: 150px; overflow-y: auto; margin-bottom: 1.5rem;"></div>

                    <h4>Recent Players</h4>
                    <div id="recent-players-list" style="max-height: 150px; overflow-y: auto;">
                        <p style="color:var(--text-muted); font-size: 0.9rem;">No recent players yet.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Play Modal (Floating/Center) -->
        <div id="game-play-overlay" style="display:none;">
            <div class="modal-card glass game-board-card">
                <div class="modal-header">
                    <h3 id="game-title">Tic-Tac-Toe</h3>
                    <button id="close-play-modal" class="icon-btn">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                
                <div class="game-status-bar">
                    <div class="player-info" id="p1-info">
                        <div class="avatar-sm" id="game-p1-avatar"></div>
                        <span id="game-p1-name">Player 1</span>
                    </div>
                    <div class="vs-badge">VS</div>
                    <div class="player-info" id="p2-info">
                        <span id="game-p2-name">Player 2</span>
                        <div class="avatar-sm" id="game-p2-avatar"></div>
                    </div>
                </div>

                <div id="game-turn-indicator" class="turn-indicator">Your Turn!</div>

                <div id="ttt-board" class="tic-tac-toe-grid">
                    <div class="cell" data-index="0" onclick="makeMove(0)"></div>
                    <div class="cell" data-index="1" onclick="makeMove(1)"></div>
                    <div class="cell" data-index="2" onclick="makeMove(2)"></div>
                    <div class="cell" data-index="3" onclick="makeMove(3)"></div>
                    <div class="cell" data-index="4" onclick="makeMove(4)"></div>
                    <div class="cell" data-index="5" onclick="makeMove(5)"></div>
                    <div class="cell" data-index="6" onclick="makeMove(6)"></div>
                    <div class="cell" data-index="7" onclick="makeMove(7)"></div>
                    <div class="cell" data-index="8" onclick="makeMove(8)"></div>
                </div>
            </div>
        </div>

    </div>
    <script src="app.js"></script>
</body>
</html>
