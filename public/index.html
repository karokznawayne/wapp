<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatVerse ‚Äî Modern Messaging</title>
    <meta name="description" content="ChatVerse - A premium social messaging app with groups, friends, and real-time communication.">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Auth Section -->
        <div id="auth-container">
            <div class="auth-card glass">
                <div class="auth-logo">
                    <div class="logo-icon">üí¨</div>
                    <h1>ChatVerse</h1>
                    <p class="auth-subtitle">Connect. Chat. Collaborate.</p>
                </div>
                <div class="tabs">
                    <button id="tab-login" class="active">Sign In</button>
                    <button id="tab-register">Sign Up</button>
                </div>
                
                <form id="login-form">
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">person</span>
                        <input type="text" id="login-username" placeholder="Username" required>
                    </div>
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">lock</span>
                        <input type="password" id="login-password" placeholder="Password" required>
                    </div>
                    <div class="input-group" id="mfa-input-group" style="display:none;">
                        <span class="input-icon material-symbols-rounded">security</span>
                        <input type="text" id="login-mfa" placeholder="MFA Code">
                    </div>
                    <button type="submit" class="btn-primary">
                        <span>Sign In</span>
                        <span class="material-symbols-rounded">arrow_forward</span>
                    </button>
                </form>

                <form id="register-form" style="display:none;">
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">person_add</span>
                        <input type="text" id="reg-username" placeholder="Choose a username" required>
                    </div>
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">lock</span>
                        <input type="password" id="reg-password" placeholder="Create a password" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <span>Create Account</span>
                        <span class="material-symbols-rounded">arrow_forward</span>
                    </button>
                </form>
                <p id="auth-message"></p>
            </div>
        </div>

        <!-- MFA Setup Section -->
        <div id="mfa-setup-container" style="display:none;">
            <div class="auth-card glass">
                <div class="auth-logo">
                    <div class="logo-icon">üîê</div>
                    <h2>Secure Your Account</h2>
                    <p class="auth-subtitle">Scan this QR Code with Google Authenticator</p>
                </div>
                <div id="qrcode-container" style="display: flex; justify-content: center; margin-bottom: 1.5rem;"></div>
                <form id="mfa-verify-form">
                    <div class="input-group">
                        <span class="input-icon material-symbols-rounded">pin</span>
                        <input type="text" id="verify-token" placeholder="Enter 6-digit Code" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <span>Verify & Enable</span>
                    </button>
                </form>
                <button id="skip-mfa" class="btn-ghost">Skip for now</button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-container" style="display:none;">
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="user-profile">
                        <div class="avatar" id="my-avatar">U</div>
                        <div class="user-info">
                            <h3 id="current-username">User</h3>
                            <span class="status-dot online"></span>
                            <span class="status-text">Online</span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button onclick="toggleTheme()" class="icon-btn" title="Toggle Theme">
                            <span class="material-symbols-rounded">contrast</span>
                        </button>
                        <button id="admin-btn" class="icon-btn" style="display:none;" title="Admin Panel">
                            <span class="material-symbols-rounded">admin_panel_settings</span>
                        </button>
                        <button id="logout-btn" class="icon-btn" title="Logout">
                            <span class="material-symbols-rounded">logout</span>
                        </button>
                    </div>
                </div>
                
                <div class="search-box">
                    <span class="material-symbols-rounded search-icon">search</span>
                    <input type="text" id="user-search" placeholder="Search users...">
                    <button id="search-btn" class="icon-btn-sm">
                        <span class="material-symbols-rounded">arrow_forward</span>
                    </button>
                    <div id="search-results" style="display: none;"></div>
                </div>

                <div class="nav-section">
                    <div class="section-header">
                        <h4><span class="material-symbols-rounded">chat</span> Chats</h4>
                    </div>
                    <ul id="chat-list"></ul>
                    
                    <div class="section-header">
                        <h4><span class="material-symbols-rounded">group</span> Friends</h4>
                    </div>
                    <ul id="friend-list"></ul>

                    <div class="section-header">
                        <h4><span class="material-symbols-rounded">groups</span> Groups</h4>
                    </div>
                    <ul id="group-list"></ul>
                    <div class="sidebar-action">
                        <button id="create-group-btn">
                            <span class="material-symbols-rounded">add</span>
                            <span>New Group</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="main-chat" id="main-chat-area">
                <div id="chat-header" style="display:none;">
                    <div id="back-btn" style="display:none;">
                        <span class="material-symbols-rounded">arrow_back</span>
                    </div>
                    <div class="avatar" id="chat-avatar"></div>
                    <div class="chat-header-info">
                        <div id="chat-title">Select a chat</div>
                        <div id="chat-subtitle" class="chat-subtitle">tap for info</div>
                    </div>
                    <button id="group-info-btn" class="icon-btn" style="display:none;">
                        <span class="material-symbols-rounded">info</span>
                    </button>
                </div>

                <div id="chat-messages">
                    <div class="placeholder">
                        <div class="placeholder-content">
                            <div class="placeholder-icon">üí¨</div>
                            <h2>ChatVerse</h2>
                            <p>Select a conversation to start messaging</p>
                        </div>
                    </div>
                </div>

                <form id="chat-input-form" style="display:none;">
                    <button type="button" class="icon-btn-sm emoji-btn">
                        <span class="material-symbols-rounded">mood</span>
                    </button>
                    <input type="text" id="message-input" placeholder="Type a message..." required autocomplete="off">
                    <button type="submit" class="send-btn">
                        <span class="material-symbols-rounded">send</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" style="display:none;">
            <div class="admin-container glass">
                <div class="admin-header">
                    <h2><span class="material-symbols-rounded">admin_panel_settings</span> Admin Dashboard</h2>
                    <button id="close-admin" class="icon-btn">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                <div id="admin-stats" class="stats-grid"></div>
                <div class="user-management">
                    <h3>All Users</h3>
                    <table id="users-table">
                        <thead>
                            <tr><th>ID</th><th>Username</th><th>Role</th><th>MFA</th><th>Status</th><th>Actions</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Modal for Group Creation -->
        <div id="modal-overlay" style="display:none;">
            <div class="modal-card glass">
                <h3><span class="material-symbols-rounded">group_add</span> Create New Group</h3>
                <div class="input-group">
                    <span class="input-icon material-symbols-rounded">label</span>
                    <input type="text" id="new-group-name" placeholder="Group Name">
                </div>
                <div class="modal-actions">
                    <button id="confirm-create-group" class="btn-primary">Create</button>
                    <button id="cancel-modal" class="btn-ghost">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Modal for Group Info -->
        <div id="group-info-modal-overlay" style="display:none;">
            <div class="modal-card glass" style="width: 420px; max-height: 80vh; display: flex; flex-direction: column;">
                <div class="modal-header">
                    <h3 id="modal-group-name">Group Info</h3>
                    <button id="close-group-info" class="icon-btn">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                
                <div id="group-actions" style="margin-bottom: 1rem; display: none;">
                    <h4>Add Member</h4>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                         <select id="friend-select-dropdown">
                             <option value="">Select a friend...</option>
                         </select>
                         <button id="add-member-btn" class="btn-primary btn-sm">Add</button>
                    </div>
                </div>

                <h4>Members (<span id="member-count">0</span>)</h4>
                <ul id="group-member-list" class="member-list"></ul>
                
                <button id="leave-group-btn" class="btn-danger">
                    <span class="material-symbols-rounded">logout</span>
                    Leave Group
                </button>
            </div>
        </div>

        <!-- Profile Settings Modal -->
        <div id="profile-modal-overlay" style="display:none;">
            <div class="modal-card glass" style="width: 480px; max-height: 85vh; display: flex; flex-direction: column;">
                <div class="modal-header">
                    <h3><span class="material-symbols-rounded">person</span> Profile Settings</h3>
                    <button id="close-profile-modal" class="icon-btn">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                
                <div class="tabs" style="margin-bottom: 1rem;">
                    <button id="tab-general" class="active" onclick="switchProfileTab('general')">General</button>
                    <button id="tab-security" onclick="switchProfileTab('security')">Security</button>
                    <button id="tab-app" onclick="switchProfileTab('app')">App</button>
                </div>

                <div id="profile-content-general" class="profile-tab-content">
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <div class="avatar" id="profile-avatar-preview" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto; transition: background 0.3s;"></div>
                        <h3 id="profile-username" style="margin-top: 0.5rem;">User</h3>
                    </div>

                    <div class="input-group">
                        <label style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem; display: block;">Bio / Status</label>
                        <input type="text" id="profile-bio" placeholder="What's on your mind?">
                    </div>

                    <div class="input-group">
                        <label style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem; display: block;">Avatar Color</label>
                        <div class="color-picker">
                            <button class="color-dot" style="background:#ef4444" onclick="selectAvatarColor('#ef4444')"></button>
                            <button class="color-dot" style="background:#f97316" onclick="selectAvatarColor('#f97316')"></button>
                            <button class="color-dot" style="background:#f59e0b" onclick="selectAvatarColor('#f59e0b')"></button>
                            <button class="color-dot" style="background:#10b981" onclick="selectAvatarColor('#10b981')"></button>
                            <button class="color-dot" style="background:#06b6d4" onclick="selectAvatarColor('#06b6d4')"></button>
                            <button class="color-dot" style="background:#3b82f6" onclick="selectAvatarColor('#3b82f6')"></button>
                            <button class="color-dot" style="background:#8b5cf6" onclick="selectAvatarColor('#8b5cf6')"></button>
                            <button class="color-dot" style="background:#ec4899" onclick="selectAvatarColor('#ec4899')"></button>
                        </div>
                        <input type="hidden" id="profile-avatar-color">
                    </div>

                    <button class="btn-primary" onclick="saveProfileGeneral()">Save Changes</button>
                </div>

                <div id="profile-content-security" class="profile-tab-content" style="display:none;">
                    <h4>Change Password</h4>
                    <form id="change-password-form" onsubmit="changePassword(event)">
                        <input type="password" id="old-password" placeholder="Current Password" required style="margin-bottom: 0.5rem;">
                        <input type="password" id="new-password" placeholder="New Password" required style="margin-bottom: 0.5rem;">
                        <button type="submit" class="btn-small">Update Password</button>
                    </form>
                    
                    <hr style="border: 0; border-top: 1px solid var(--border); margin: 1.5rem 0;">

                    <h4>Two-Factor Authentication</h4>
                    <div id="mfa-status-section">
                        <p id="mfa-status-text" style="margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-muted);">Status: <span id="mfa-status-badge" class="role-badge">Checking...</span></p>
                        <button id="btn-enable-mfa" class="btn-small" onclick="enableMFA()" style="display:none;">Enable MFA (Setup)</button>
                        <button id="btn-disable-mfa" class="btn-small btn-danger" onclick="promptDisableMFA()" style="display:none;">Disable MFA</button>
                    </div>
                </div>

                <div id="profile-content-app" class="profile-tab-content" style="display:none;">
                    <h4>Notifications</h4>
                    <div class="setting-row">
                        <span>Message Sounds</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-sound" checked onchange="toggleSetting('sound')">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <span>Browser Notifications</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-browser-notif" onchange="toggleSetting('browserNotif')">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <hr style="border: 0; border-top: 1px solid var(--border); margin: 1.5rem 0;">

                    <h4>Theme</h4>
                    <div class="setting-row">
                        <span>Dark Mode</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-dark-mode" checked onchange="toggleTheme()">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

            </div>
        </div>

    </div>
    <script src="app.js"></script>
</body>
</html>
